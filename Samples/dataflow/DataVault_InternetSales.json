{
	"name": "DataVault_InternetSales",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "BLOB_dvs_internetsales_incr_ds",
						"type": "DatasetReference"
					},
					"name": "SourceInternetSales",
					"script": "source(output(\n\t\tProductAlternateKey as string,\n\t\tCustomerAlternateKey as string,\n\t\tSalesOrderNumber as string,\n\t\tSalesOrderLineNumber as boolean,\n\t\tRevisionNumber as boolean,\n\t\tOrderQuantity as boolean,\n\t\tUnitPrice as double,\n\t\tExtendedAmount as double,\n\t\tUnitPriceDiscountPct as boolean,\n\t\tDiscountAmount as boolean,\n\t\tProductStandardCost as double,\n\t\tTotalProductCost as double,\n\t\tSalesAmount as double,\n\t\tTaxAmt as double,\n\t\tFreight as double,\n\t\tCarrierTrackingNumber as string,\n\t\tCustomerPONumber as string,\n\t\tOrderDate as string,\n\t\tDueDate as string,\n\t\tShipDate as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false) ~> SourceInternetSales"
				},
				{
					"dataset": {
						"referenceName": "ASQL_DV_LINK_InternetSales",
						"type": "DatasetReference"
					},
					"name": "LinkInternetSales",
					"script": "source(output(\n\t\tLINK_InternetSales_HK as long,\n\t\tHUB_Customer_HK as long,\n\t\tHUB_Product_HK as long,\n\t\tSalesOrderNumber as string,\n\t\tSalesOrderLineNumber as integer,\n\t\tLOAD_TS as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'table') ~> LinkInternetSales"
				},
				{
					"dataset": {
						"referenceName": "ASQL_DV_SAT_Product_Latest",
						"type": "DatasetReference"
					},
					"name": "SatProduct",
					"script": "source(output(\n\t\tHUB_Product_HK as long,\n\t\tSAT_Product_HDIFF as long\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'table') ~> SatProduct"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "ASQL_DV_HUB_Product",
						"type": "DatasetReference"
					},
					"name": "SinkHubProduct",
					"script": "NewHubProduct sink(input(\n\t\tHUB_Product_HK as long,\n\t\tProductAlternateKey as string,\n\t\tLOAD_TS as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'table',\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false) ~> SinkHubProduct"
				},
				{
					"dataset": {
						"referenceName": "ASQL_DV_SAT_Product",
						"type": "DatasetReference"
					},
					"name": "SinkSatProduct",
					"script": "NewSatProduct sink(input(\n\t\tHUB_Product_HK as long,\n\t\tWeightUnitMeasureCode as string,\n\t\tSizeUnitMeasureCode as string,\n\t\tEnglishProductName as string,\n\t\tStandardCost as decimal(19,4),\n\t\tFinishedGoodsFlag as boolean,\n\t\tColor as string,\n\t\tSafetyStockLevel as integer,\n\t\tReorderPoint as integer,\n\t\tListPrice as decimal(19,4),\n\t\tSize as string,\n\t\tSizeRange as string,\n\t\tWeight as double,\n\t\tModelName as string,\n\t\tSAT_Product_HDIFF as long,\n\t\tLOAD_TS as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tformat: 'table',\n\tdeletable:false,\n\tinsertable:true,\n\tupdateable:false,\n\tupsertable:false) ~> SinkSatProduct"
				}
			],
			"transformations": [
				{
					"name": "HashColumns",
					"script": "SourceInternetSales derive(LINK_InternetSales_HK = crc32(ProductAlternateKey,CustomerAlternateKey,SalesOrderNumber,SalesOrderLineNumber),\n\t\tHUB_Customer_HK = crc32(CustomerAlternateKey),\n\t\tLOAD_TS = currentTimestamp(),\n\t\tHUB_Product_HK = crc32(ProductAlternateKey),\n\t\tSAT_InternetSales_HDIFF = crc32(ProductAlternateKey,CustomerAlternateKey,SalesOrderNumber,SalesOrderLineNumber,RevisionNumber,OrderQuantity,UnitPrice,ExtendedAmount,UnitPriceDiscountPct,DiscountAmount,ProductStandardCost,TotalProductCost,SalesAmount,TaxAmt,Freight,CarrierTrackingNumber,CustomerPONumber,OrderDate,DueDate)) ~> HashColumns"
				},
				{
					"name": "CheckNewLinkInternetSales",
					"script": "HashColumns, LinkInternetSales exists(LINK_InternetSales_HK == LinkInternetSales@LINK_InternetSales_HK,\n\tnegate:true,\n\tbroadcast: 'both')~> CheckNewLinkInternetSales"
				},
				{
					"name": "NewHubProduct",
					"script": "CheckNewLinkInternetSales select(mapColumn(\n\t\tProductAlternateKey,\n\t\tHUB_Product_HK = LINK_InternetSales_HK,\n\t\tLOAD_TS\n\t))~> NewHubProduct"
				},
				{
					"name": "CheckNewSatProduct",
					"script": "HashColumns, SatProduct exists(LINK_InternetSales_HK == SatProduct@HUB_Product_HK\n\t&& HUB_Customer_HK == SAT_Product_HDIFF,\n\tnegate:true,\n\tbroadcast: 'none')~> CheckNewSatProduct"
				},
				{
					"name": "NewSatProduct",
					"script": "CheckNewSatProduct select(mapColumn(\n\t\tWeightUnitMeasureCode,\n\t\tSizeUnitMeasureCode,\n\t\tEnglishProductName,\n\t\tStandardCost,\n\t\tFinishedGoodsFlag,\n\t\tColor,\n\t\tSafetyStockLevel,\n\t\tReorderPoint,\n\t\tListPrice,\n\t\tSize,\n\t\tSizeRange,\n\t\tWeight,\n\t\tModelName,\n\t\tHUB_Product_HK = LINK_InternetSales_HK,\n\t\tSAT_Product_HDIFF = HUB_Customer_HK,\n\t\tLOAD_TS\n\t))~> NewSatProduct"
				}
			]
		}
	}
}